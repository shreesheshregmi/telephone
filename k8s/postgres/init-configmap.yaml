apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-init-sql
  namespace: phone-directory
data:
  init.sql: |
    -- Initialize database with schema and sample data
    CREATE TABLE IF NOT EXISTS contacts (
        id SERIAL PRIMARY KEY,
        name VARCHAR(100) NOT NULL,
        phone VARCHAR(20) NOT NULL UNIQUE,
        address TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );
    
    CREATE INDEX IF NOT EXISTS idx_contacts_name ON contacts(name);
    CREATE INDEX IF NOT EXISTS idx_contacts_phone ON contacts(phone);
    
    -- Insert sample data (only if table is empty)
    INSERT INTO contacts (name, phone, address) 
    SELECT 'John Doe', '555-0101', '123 Main St, Springfield'
    WHERE NOT EXISTS (SELECT 1 FROM contacts LIMIT 1);
    
    INSERT INTO contacts (name, phone, address) 
    SELECT 'Jane Smith', '555-0102', '456 Oak Ave, Shelbyville'
    WHERE NOT EXISTS (SELECT 1 FROM contacts WHERE phone = '555-0102');
    
    INSERT INTO contacts (name, phone, address) 
    SELECT 'Robert Johnson', '555-0103', '789 Pine Rd, Capital City'
    WHERE NOT EXISTS (SELECT 1 FROM contacts WHERE phone = '555-0103');